# Measuring Devops
## 測定と報酬の重要性：望む結果を得るために
***
### 「Aを評価しつつBを期待する愚行」
* 人々は報酬が与えられる活動を追求し、評価されない活動は軽視する傾向がある。
* この原則は「**You get what you measure（測定するものが得られる）**」として要約できる。
* 目標（B）とは異なるもの（A）を測定・評価すると、望まない結果が引き起こされる。
    * **例**: コードの行数（KLOC）を評価すると、冗長で質の低いコードが増える。
    * **例**: 個人間の相対評価（ランキング）を行うと、協力的な行動が失われ、反社会的な行動が促進される。
***
### DevOpsと文化変革のための測定
#### ソーシャルメトリクスによる協力の促進
* 協力的な文化を醸成するには、協力的な行動を測定・評価する必要がある。
* 以下の2つの指標を組み合わせて測定することで、**コードの共有**と**再利用**を促進できる。
    1.  **自分が作ったコードがどのくらい活用されているか？**: 自身のコードが他の開発者に価値があると認識されるインセンティブとなる。
    2.  **自分が他者のコードをどのくらい活用しているか？**: 車輪の再発明を防ぎ、既存の資産を有効活用するインセンティブとなる。
#### DevOpsメトリクスによる継続的改善
* DevOpsにおける継続的改善は、現状を正確に測定することから始まる。
* **ベースライン**を設定し、具体的な**改善目標**を立てることで、進捗を可視化できる。
    * **ステップ**:
        1.  **ベースラインの測定**: 現在の状況（例: デプロイに10時間かかる、6人のチームメンバーが必要）を把握する。
        2.  **目標の設定**: 具体的な改善目標（例: デプロイ時間を2時間にする）を設定する。
        3.  **改善と評価**: 目標達成に向けて施策を講じ、成果を測定する。目標が達成できなければ、異なる方法を試みる。
***
### 問題解決へのアプローチの変化
* DevOpsは問題解決のパラダイムを根本的に変える。
    * **旧来**: **平均故障間隔（Mean Time To Failure, MTTF）**を最大化する（故障を完全に防ぐ）ことが目標だった。
    * **DevOps**: **平均復旧時間（Mean Time To Recovery, MTTR）**を最小化する（故障からの迅速な回復）ことが目標となる。
* 故障は避けられないという前提に立ち、いかに迅速に復旧するかに焦点を当てる。
* **マイクロサービス**や**コンテナ**などの技術は、この「**迅速な復旧**」という考え方を実現するための基盤となる。
    * コンテナがダウンしても、新しいコンテナを起動することで迅速にサービスを復旧できる。
    * このアプローチにより、ユーザーはサービスダウンに気づかないことも多い。

## 虚栄の指標（Vanity Metrics）と実行可能な指標（Actionable Metrics）

### 虚栄の指標（Vanity Metrics）とは

* **定義**: 一見すると好調に見えるが、具体的な**行動**や**意思決定**に結びつかない指標。
* **例**: ウェブサイトへの「**ヒット数**」。10,000ヒットという数字は素晴らしいと感じるかもしれないが、それが1人のユーザーによる連続クリックなのか、10,000人の新規ユーザーなのかが分からず、次にどう行動すべきかを判断できない。
* **特徴**:
    * 感情的に満足感を得ることはできるが、**原因と結果の関係**が不明瞭。
    * ビジネスの改善に役立つ洞察を提供しない。

***

### 実行可能な指標（Actionable Metrics）とは

* **定義**: サービスや製品の改善のために、明確な**行動**を促すことができる指標。
* **特徴**:
    * **原因と結果の関係**を明確にする。
    * 具体的な施策の効果を測定し、次の一手を判断できる。
    * **A/Bテスト**はその好例。新機能を導入したグループとそうでないグループの収益を比較することで、新機能の価値を明確に測定し、全てのユーザーに展開するかどうかを決定できる。

***

### 実行可能な指標の例

#### リーンスタートアップの著者、エリック・リースによる例
* **新機能の市場投入までの時間短縮**: 顧客を喜ばせる新機能を迅速に提供する。
* **製品の全体的な可用性の向上**: どんなに素晴らしい機能でも、サービスが利用できなければ意味がない。
* **ソフトウェアリリースのデプロイ時間短縮**: リリース準備が整った後のデプロイ作業を迅速化する。
* **テスト段階での不具合検出率の向上**: 本番環境での不具合を減らす。
* **ハードウェアインフラの効率的な利用**: コスト削減と利益向上に直結する。
* **パフォーマンスやユーザーフィードバックの迅速な提供**: 情報に基づいた意思決定を可能にする。

#### DevOpsにおける4つの主要な指標（ニコル・フォースグレン提唱）
DevOpsの成功を測る上で特に重要とされる、以下の4つの指標が挙げられる。

* **リードタイム**: アイデアが本番環境にデプロイされるまでの時間。
* **デプロイ頻度**: どのくらいの頻度でリリースできるか。市場の変化に迅速に対応するために重要。
* **変更失敗率**: 変更が本番環境で不具合を引き起こす割合。スピードだけでなく、安定性も重要。
* **平均復旧時間（MTTR）**: 障害が発生した際に、サービスを復旧させるまでの時間。**平均故障間隔（MTTF）**を重視する旧来の考え方とは異なり、障害を前提として迅速な復旧能力を測る。

## チームカルチャーの測定方法

この講義では、チームの文化を測定するための具体的な項目について、**Dr. Nicole Forsgren**が開発した評価方法を中心に解説します。一見難しそうに思えるチームカルチャーの測定も、この手法を使えば客観的に評価できます。

---

### チームカルチャー測定の6つの重要項目

Dr. Nicole Forsgrenの評価方法では、以下の6つの項目に対するチームメンバーの同意度を、**1（強く反対）から7（強く同意）の7段階**で評価します。

#### 1. 情報の積極的な探求
* **「私のチームでは、情報が積極的に探求されています」**
    * なぜ物事が起こるのか、メンバーが**好奇心**を持って原因を追求する文化があるかを測ります。

#### 2. 失敗からの学習と「メッセンジャー」への処罰なし
* **「私のチームでは、失敗は学習の機会であり、情報を報告した人が罰せられることはありません」**
    * 実験の失敗を許容し、そこから学ぶ文化を促進します。
    * 「メッセンジャーを撃つな（Don't shoot the messenger）」という考え方に基づき、問題の報告者が罰せられない**「非難しない文化」（blameless culture）**があるかを測ります。失敗を個人の責任ではなく、**システムの失敗**として捉えることが重要です。

#### 3. 責任の共有
* **「私のチームでは、責任が共有されています」**
    * 問題が発生した際、特定の誰かではなく、**全員で協力して解決**しようとする姿勢があるかを測ります。
    * 「私たちは皆同じ船に乗っている」という意識を評価します。

#### 4. 部門横断的な協力の奨励
* **「私のチームでは、部門横断的な協力が奨励され、報われています」**
    * 個人ではなく、**協力者としての貢献**が評価される測定システムになっているかを測ります。
    * 「何を測定するかによって、何が得られるかが決まる（you get what you measure）」という原則に基づいています。

#### 5. 失敗の原因究明
* **「私のチームでは、失敗は原因究明につながります」**
    * 失敗の原因を「誰がやったか（who done it）」ではなく、**「システムがどのように失敗したか（where did the system fail the people）」**という視点で探求する文化を測ります。
    * 根本原因を特定し、**継続的な改善**につなげようとする姿勢を評価します。

#### 6. 新しいアイデアの歓迎
* **「私のチームでは、新しいアイデアが歓迎されています」**
    * メンバーが自由に意見を述べ、そのアイデアが真剣に受け止められる環境があるかを測ります。
    * 誰もが歓迎され、貢献できると感じているかを確認することで、チームの健全性を判断します。

## DevOpsとSRE（サイト信頼性エンジニアリング）の比較

この講義では、**DevOps**と**SRE（サイト信頼性エンジニアリング）**がどのように異なり、共通点があり、そしてどのように連携できるかについて解説します。

---

### SRE（サイト信頼性エンジニアリング）とは

**SRE**は、**ソフトウェアエンジニアリングのアプローチを運用業務に適用する**ことで、システムの信頼性を向上させる手法です。

* **SREの原則**:
    * **ソフトウェアエンジニアの採用**: 運用業務を自動化するために、プログラミング能力を持つエンジニアを雇用します。
    * **トイル（Toil）の削減**: 反復的で手動な作業（トイル）を自動化することに焦点を当て、SREエンジニアは時間の約50%をこれに費やすことが推奨されています。
    * **エラーバジェットによる安定性制御**: サービスレベル目標（SLO）に基づいて**エラーバジェット**を設定し、開発チームはこの予算内で障害を発生させることが許可されます。予算を超過すると、デプロイが停止され、安定性回復が優先されます。

---

### DevOpsとSREの主な違い

両者のアプローチは根本的に異なります。

| 比較項目 | DevOps | SRE |
| :--- | :--- | :--- |
| **チーム構成** | 開発と運用の**サイロをなくし**、一つのチームで共通のビジネス目標を追求する。 | 開発チームと運用チーム（SRE）は**分離されたまま**。ただし、人員は共通のプールから調整される。 |
| **生産環境の責任** | **「あなたが作り、あなたが運用する（You build it, you run it）」**の考え方で、開発者が本番環境の責任を負う。 | 開発チームが作成したアプリケーションを、SREチームが運用する。 |
| **安定性の維持** | 継続的デリバリー（CD）パイプラインによる**自動化**と、全員の責任によって安定性を確保する。 | SLOに基づいた**エラーバジェット**で安定性を制御する。 |

---

### DevOpsとSREの共通点

アプローチは異なりますが、共通の目的と文化を持っています。

* **共通の目標**: ソフトウェアをより速く、かつ安定してデプロイすること。
* **相互理解**: 開発と運用の作業をお互いに可視化し、理解を深める。
    * SRE: 開発者が運用チームに一定期間**ローテーション**することで実現。
    * DevOps: 開発と運用が同じチームにいることで実現。
* **非難しない文化（Blameless Culture）**: 失敗は個人の責任ではなく、**システム**の失敗として捉え、改善に活かす文化が重要。

---

### DevOpsとSREの連携

SREとDevOpsは補完的な関係にあります。

* **役割分担**:
    * **SREチーム**: インフラストラクチャを維持・提供する役割。クラウド環境における**オペレーター**に相当します。
    * **DevOpsチーム**: そのインフラストラクチャを利用してアプリケーションを構築・運用する役割。クラウド環境における**コンシューマー**に相当します。
* **連携例**: SREチームが**Platform as a Service (PaaS)**のような基盤を提供し、DevOpsチームがそのプラットフォームを活用してアプリケーションをデプロイする、という構成が考えられます。